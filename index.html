<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js" integrity="sha512-Y8iWYJDo6HiTo5xtml1g4QqHtl/PO1w+dmUpQfQSOTqKNsMhExfyPN2ncNAe9JuJUSKzwK/b6oaNPop4MXzkwg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <title> Cases Recorded for Selected Major Offences </title>
  <style type="text/css">
    html, body, div.content { width:100%; height:100%; margin:0;  }
  </style>
</head>
<body>

  <div class="content">
    <h1>Cases Recorded for Selected Major Offences</h1>
    <script>

      async function fetchRecordData() {
        let response = await fetch('https://data.gov.sg/api/action/datastore_search?resource_id=83c21090-bd19-4b54-ab6b-d999c251edcf');
        let data = await response.json();
        console.log(data.result.records);
        let records = data.result.records;

        var margin = {top: 20, right: 20, bottom: 40, left: 40},
        width = 1060 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom,
        svgWidth = 1160,
        svgHeight = 600;
        /*
        var categories = []
        for (let k = 0; k < 10; k++) {
          categories.push(records[k].level_2)
        }
        console.log(categories)
        */

        var i = 1;
        var partOfRecords = []
        var recordId = ""

        for (let k = 0; k < records.length; k+=10) {
          partOfRecords = records.slice(k, k+10);
          recordId = "record" + i.toString();


          var svg = d3.select(".dataCharts")
          .append("svg")
          //.attr("margin", "50px")
          .attr("preserveAspectRatio", "xMinYMin meet")
          .attr("viewBox", "0 0 "+ svgWidth.toString() + " " + svgHeight.toString())
          .attr("id", recordId);

          var record = d3.select("#"+recordId)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          // Add scales
          var xScale = d3.scaleBand()
          .domain(partOfRecords.map(function(d) { return d.level_2; }))
          .rangeRound([0, width])
          .padding(0.2);

          var yScale = d3.scaleLinear()
          .domain([0, 2000])
          .rangeRound([height, 0]);

          // Add x-axis
          record.append("g")
          .attr("class", "axis axis-x")
          .attr("transform", "translate(0," + (height) + ")")
          .call(d3.axisBottom(xScale));


          // Add y-axis
          record.append("g")
          .attr("class", "axis axis-y")
          .call(d3.axisLeft(yScale).ticks(15));

          record.append("text")
          .data(partOfRecords)
          .attr("transform", "translate(" + (width / 2) + "," + (height + 40) + ")")
          .text(function(d) { return "Year: " + d.year })
          .attr("text-align", "middle");

          // Append rectangles
          record.selectAll("rect")
          .data(partOfRecords)
          .enter()
          .append("rect")
          .attr("x", function(d) { return xScale(d.level_2);})
          .attr("y", function(d) { return yScale(d.value); })
          .attr("width", function(d) {return xScale.bandwidth();})
          .attr("height", function(d) { return height - yScale(d.value); })
          .attr("class", "svgRect")
          .attr("fill", "red")
          .on('mouseover', function (d, i) {
            d3.select(this).transition()
            .duration('50')
            .attr('opacity', '.50');
          })
          .on('mouseout', function (d, i) {
            d3.select(this).transition()
            .duration('50')
            .attr('opacity', '1');
          });
              i++;
        }
        /*
        for (let k = 0; k < records.length; k+=10) {
          for (let i = k; i < k+10; i++) {
            appendThis = "<tr><td>"+records[i].level_2+"</td><td>"+records[i].year+"</td><td>"+records[i].value+"</td></tr>";
            $(".casesTable").append(appendThis)
          }
        }
        */

      }
      fetchRecordData();
    </script>
    <div class='dataCharts'>
      <!--<svg id="chart" viewBox="0 0 960 500"></svg>-->
      <script>
        /*
        var data = [
        {student: "Alfred", score: 65},
        {student: "Bernard", score: 35},
        {student: "Christine", score: 75}
        ];
        

        var data = fetchRecordData();


        */

      </script>
    </div>
  </div>



</body>
</html>